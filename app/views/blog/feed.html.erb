<turbo-frame id="blog_feed" class="w-full">
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
    <%= render partial: "left_sidebar", locals: { tags: @tags, total_posts_count: @total_posts_count } %>

    <div class="lg:col-span-2 space-y-8">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-3xl font-bold">All Posts</h1>
        <!-- Option: Sort dropdown could go here -->
      </div>

      <!-- Mobile Tags -->
      <div class="lg:hidden flex overflow-x-auto pb-4 gap-2 no-scrollbar">
        <a href="<%= blog_index_path %>" data-turbo-frame="_top" class="shrink-0 px-4 py-1.5 rounded-full text-sm border <%= params[:tag].nil? ? 'bg-primary text-primary-foreground border-primary' : 'bg-background hover:bg-muted' %>">All</a>
        <% @tags.each do |tag, count| %>
        <a href="<%= blog_index_path(tag: tag) %>" data-turbo-frame="_top" class="shrink-0 px-4 py-1.5 rounded-full text-sm border <%= params[:tag] == tag ? 'bg-primary text-primary-foreground border-primary' : 'bg-background hover:bg-muted' %>"><%= tag %></a>
        <% end %>
      </div>

      <div class="space-y-8">
        <% if @posts.any? %>
        <% @posts.each do |post| %>
        <article class="group relative bg-card/30 rounded-2xl overflow-hidden border border-border hover:border-primary/50 transition-all duration-300">
          <% if post.cover_image.present? %>
          <div class="aspect-video w-full overflow-hidden">
            <img src="<%= post.cover_url %>" alt="<%= post.title %>" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
          </div>
          <% end %>

          <div class="p-6 space-y-4">
            <div class="flex flex-wrap gap-2">
              <% post.tags.each do |tag| %>
              <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-secondary text-secondary-foreground"><%= tag %></span>
              <% end %>
            </div>

            <div class="space-y-2">
              <h2 class="text-2xl font-bold leading-tight group-hover:text-primary transition-colors">
                <%= link_to post.title, blog_path(post.slug), data: { turbo_frame: "_top" }, class: "after:absolute after:inset-0" %>
              </h2>
              <% if post.summary.present? %>
              <p class="text-muted-foreground line-clamp-3 leading-relaxed"><%= post.summary %></p>
              <% end %>
            </div>

            <div class="flex items-center gap-2 text-sm text-muted-foreground pt-2">
              <div class="flex items-center gap-2">
                <div class="w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center text-[10px] text-primary">HC</div>
                <span>Hyunchul Cho</span>
              </div>
              <span>â€¢</span>
              <time datetime="<%= post.published_date %>">
                <%= post.published_date.strftime("%B %d, %Y") if post.published_date %>
              </time>
            </div>
          </div>
        </article>
        <% end %>
        <% else %>
        <div class="text-center py-20 bg-card/30 rounded-2xl border border-dashed border-border">
          <p class="text-muted-foreground">No posts found.</p>
        </div>
        <% end %>
      </div>
    </div>

    <%= render "right_sidebar" %>
  </div>
</turbo-frame>